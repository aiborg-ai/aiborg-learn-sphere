# RUM Quick Start Guide

## ðŸš€ Quick Setup

### 1. Deploy Database Migration

```bash
# Option 1: Using Supabase CLI
npx supabase db push

# Option 2: Direct SQL
psql -f supabase/migrations/20250110_performance_monitoring.sql
```

### 2. Configure Alerts (Optional)

```sql
-- Update email recipients for alerts
UPDATE performance_budgets
SET alert_recipients = ARRAY['your-email@example.com']
WHERE metric_name IN ('LCP', 'FID', 'CLS');
```

### 3. Deploy to Production

```bash
npm run build
git add .
git commit -m "Add RUM monitoring"
git push origin main
```

## âœ… Verification

### Check Data Collection

```sql
-- Check metrics (after some users visit)
SELECT COUNT(*) FROM performance_metrics
WHERE created_at > NOW() - INTERVAL '1 hour';

-- Check sessions
SELECT COUNT(*) FROM rum_sessions
WHERE start_time > NOW() - INTERVAL '1 hour';

-- Check errors (hopefully 0!)
SELECT COUNT(*) FROM error_reports
WHERE created_at > NOW() - INTERVAL '1 hour';
```

## ðŸ“Š View Data

### Performance by Page

```sql
SELECT * FROM performance_by_page
ORDER BY total_sessions DESC
LIMIT 10;
```

### Recent Errors

```sql
SELECT * FROM error_reports
WHERE NOT resolved
ORDER BY created_at DESC
LIMIT 20;
```

### Active Alerts

```sql
SELECT * FROM performance_alerts
WHERE NOT acknowledged
ORDER BY created_at DESC;
```

## ðŸ”§ Custom Tracking

### Track Custom Metrics

```typescript
import { webVitalsService } from '@/services/monitoring';

// Business metric
webVitalsService.trackCustomMetric('checkout-complete', 1500, 'ms', {
  amount: 99.99,
});

// Performance metric
webVitalsService.trackCustomMetric('api-response-time', 250, 'ms', {
  endpoint: '/api/courses',
});
```

### Get Current Metrics

```typescript
import { webVitalsService, rumService } from '@/services/monitoring';

const metrics = webVitalsService.getMetricsSummary();
console.log('LCP:', metrics.LCP?.value, metrics.LCP?.rating);

const session = rumService.getSessionSummary();
console.log('Session:', session);
```

## ðŸŽ¯ Performance Budgets

### View Current Budgets

```sql
SELECT * FROM performance_budgets
WHERE is_active = true;
```

### Update Threshold

```sql
UPDATE performance_budgets
SET good_threshold = 2000, poor_threshold = 3500
WHERE metric_name = 'LCP' AND device_type = 'mobile';
```

### Add Custom Budget

```sql
INSERT INTO performance_budgets (
  metric_name,
  good_threshold,
  poor_threshold,
  target_url,
  device_type
) VALUES (
  'LCP',
  2000,
  3500,
  '/dashboard',
  'all'
);
```

## ðŸ“ˆ Common Queries

### Slowest Pages

```sql
SELECT
  url,
  AVG((metrics->>'lcp')::decimal) as avg_lcp,
  COUNT(*) as sessions
FROM performance_reports
WHERE created_at > NOW() - INTERVAL '24 hours'
GROUP BY url
ORDER BY avg_lcp DESC
LIMIT 10;
```

### Error Summary

```sql
SELECT
  message,
  COUNT(*) as occurrences,
  COUNT(DISTINCT user_id) as affected_users
FROM error_reports
WHERE created_at > NOW() - INTERVAL '7 days'
GROUP BY message
ORDER BY occurrences DESC;
```

### User Engagement

```sql
SELECT
  DATE_TRUNC('day', start_time) as date,
  COUNT(*) as total_sessions,
  AVG(duration_ms) as avg_duration,
  SUM(page_views) as total_page_views
FROM rum_sessions
WHERE start_time > NOW() - INTERVAL '30 days'
GROUP BY DATE_TRUNC('day', start_time)
ORDER BY date DESC;
```

## ðŸ”” Alert Management

### Acknowledge Alert

```sql
UPDATE performance_alerts
SET
  acknowledged = true,
  acknowledged_by = auth.uid(),
  acknowledged_at = NOW()
WHERE id = 'alert-id';
```

### Disable Alerts for Page

```sql
UPDATE performance_budgets
SET alert_enabled = false
WHERE target_url = '/maintenance';
```

## ðŸ§¹ Maintenance

### Cleanup Old Data

```sql
-- Delete old metrics (keep 90 days)
DELETE FROM performance_metrics
WHERE created_at < NOW() - INTERVAL '90 days';

-- Delete resolved errors (keep 90 days)
DELETE FROM error_reports
WHERE created_at < NOW() - INTERVAL '90 days'
  AND resolved = true;
```

## ðŸ“š Full Documentation

See `RUM_IMPLEMENTATION_GUIDE.md` for complete documentation.

---

**Quick Help:**
- Issues? Check browser console for errors
- No data? RUM only runs in production
- Need help? See full guide or check logs
